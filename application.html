<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orion - Open an Account</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-storage-compat.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>


</head>

<body class="bg-blue-50">

    <!-- Container -->
    <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-blue-900">
        <div class="max-w-6xl w-full grid grid-cols-1 lg:grid-cols-2 bg-white shadow-xl rounded-lg overflow-hidden">

            <!-- Left Side (Information) -->
            <div class="p-8 bg-blue-900 text-white">
                <h2 class="text-3xl font-extrabold">Open an Orion Account</h2>
                <p class="mt-4 text-lg">It's easy. Here's how to get started:</p>

                <ul class="mt-6 space-y-4">
                    <li class="flex items-start">
                        <span
                            class="inline-block w-8 h-8 text-center font-bold bg-blue-700 text-white rounded-full">1</span>
                        <p class="ml-4 text-lg">Create a username and password</p>
                    </li>
                    <li class="flex items-start">
                        <span
                            class="inline-block w-8 h-8 text-center font-bold bg-blue-700 text-white rounded-full">2</span>
                        <p class="ml-4 text-lg">Confirm your email address</p>
                    </li>
                    <li class="flex items-start">
                        <span
                            class="inline-block w-8 h-8 text-center font-bold bg-blue-700 text-white rounded-full">3</span>
                        <p class="ml-4 text-lg">Complete the application</p>
                    </li>
                </ul>

                <div class="mt-8">
                    <div class="flex space-x-4 border-b border-gray-400 pb-2">
                        <button id="indButton"
                            class="text-sm font-bold uppercase tracking-wide border-b-2 border-white">Individuals</button>
                        <button id="instButton"
                            class="text-sm uppercase tracking-wide text-gray-300 hover:text-white">Institutions</button>
                    </div>
                    <ul id="individual" class="mt-4 space-y-2 text-gray-300 text-sm">
                        <li><span class="text-white">&#10003;</span> Personal and contact information</li>
                        <li><span class="text-white">&#10003;</span> Income and tax residency information</li>
                        <li><span class="text-white">&#10003;</span> Trading experience and objectives</li>
                        <li><span class="text-white">&#10003;</span> Bank account information</li>
                    </ul>

                    <ul id="institution" class="mt-4 space-y-2 text-gray-300 text-sm hidden">
                        <li><span class="text-white">&#10003;</span> Institutional and authorized signatory details</li>
                        <li><span class="text-white">&#10003;</span> Financial statements and corporate tax residency
                        </li>
                        <li><span class="text-white">&#10003;</span> Institutional trading experience and investment
                            goals
                        </li>
                        <li><span class="text-white">&#10003;</span> Corporate bank account information</li>
                    </ul>

                    <p class="mt-6 text-sm">
                        Do you want to Sign in?
                        <a href="./signin.html" class="text-blue-200 underline">Click Here</a>
                    </p>

                </div>
            </div>

            <!-- Right Side (Form) -->
            <div class="p-8">
                <h2 class="text-2xl font-semibold text-gray-900">Create a Username and Password</h2>

                <form class="mt-6 space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                        <input id="email" name="email" type="email" required
                            class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Email">
                    </div>

                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                        <input id="username" name="username" type="text"
                            class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Username">
                    </div>

                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                        <div class="relative mt-1">
                            <input id="password" name="password" type="password" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Password">
                            <span id="togglePassword"
                                class="absolute inset-y-0 right-4 flex items-center text-blue-500 cursor-pointer">Show</span>
                        </div>
                    </div>

                    <div>
                        <label for="confirm_password" class="block text-sm font-medium text-gray-700">Confirm
                            Password</label>
                        <input id="confirm_password" name="confirm_password" type="password" required
                            class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Confirm Password">
                    </div>

                    <div>
                        <label for="country" class="block text-sm font-medium text-gray-700">Country</label>
                        <select id="country" name="country" required
                            class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option>United States</option>
                            <option>Canada</option>
                            <option>United Kingdom</option>
                            <option>Australia</option>
                            <!-- Add more options as necessary -->
                        </select>
                    </div>

                    <div>
                        <button id="submit" type="submit"
                            class="relative w-full mt-6 py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md shadow-sm focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <span class="button-text">Create Account</span>
                            <span class="spinner hidden absolute inset-0 flex justify-center items-center">
                                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg"
                                    fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                                </svg>
                            </span>
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>

    <script src="./assets/js/script.js" ></script>
</body>

</html>


<script>
    // Function to show a success toast
    function showSigninSuccess() {
        Toastify({
            text: "Account Created Successfully!",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "linear-gradient(to right, #00b09b, #96c93d)",
            close: true,
        }).showToast();
    }

    // Get the sign-up button
    const submit = document.getElementById("submit");

    document.getElementById("togglePassword").addEventListener("click", function () {
        const passwordInput = document.getElementById("password");
        const toggleButton = document.getElementById("togglePassword");

        if (passwordInput.type === "password") {
            passwordInput.type = "text"; // Change to text to show password
            toggleButton.textContent = "Hide Password"; // Update button text
        } else {
            passwordInput.type = "password"; // Change back to password
            toggleButton.textContent = "Show Password"; // Update button text
        }
    });

    submit.addEventListener('click', async (e) => {
        e.preventDefault();

        const username = document.getElementById("username").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const confirmPassword = document.getElementById("confirm_password").value;
        const country = document.getElementById("country").value;

        const spinner = submit.querySelector('.spinner');
        const buttonText = submit.querySelector('.button-text');

        if (password.length < 6) {
            alert("Password is too short");
            return;
        }

        if (password !== confirmPassword) {
            alert("Passwords do not match");
            return;
        }

        try {
            // Show spinner and hide button text
            spinner.classList.remove('hidden');
            buttonText.classList.add('hidden');

            // Create the user in Firebase Authentication
            const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;

            // Store additional user information in Firestore
            await db.collection("users").doc(user.uid).set({ // Use user.uid for the document ID
                email: email,
                username: username,
                country: country,
                currentBalance: 905000.00,
                brokerage: -48000.50,
                dividend: 21720.00,
                transactionPin: '0000',

                // Note: Storing password in Firestore is not recommended for security reasons
            });

            console.log("Document successfully written!");
            localStorage.setItem('userDocId', user.uid); // Store the user ID in local storage

            showSigninSuccess();

            // Wait for the toast to be shown before redirecting
            setTimeout(() => {
                spinner.classList.add('hidden');
                buttonText.classList.remove('hidden');
                window.location.href = "./applicationprocess.html";
            }, 3000); // Match the duration of the toast notification

        } catch (error) {
            spinner.classList.add('hidden');
            buttonText.classList.remove('hidden');

            var errorMessage = error.message;
            console.error("Error:", errorMessage);
            alert("Error: " + errorMessage);
        }
    });
</script>


<!-- SIGNOUT SCRIPT -->
<script>
    // Function to handle sign-out
    const signout = document.getElementById("signout-button");

    signout.addEventListener('click', (e) => {
        e.preventDefault();
        auth.signOut().then(() => {
            // Sign-out successful.
            showSignOutSuccess();

            // Optionally, redirect to a login page or another page
            window.location.href = "signin.html"; // Change this to your login page
        }).catch((error) => {
            // An error happened.
            Toastify({
                text: `Error signing out: ${error.message}`,
                duration: 3000,
                gravity: "top",
                position: "right",
                backgroundColor: "linear-gradient(to right, #ff0000, #ff6347)",
                close: true
            }).showToast();
        });
    })

</script>